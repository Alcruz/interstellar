\section{Front fixing method}

\subsection{Inverse transformation}

In order for remove the free boundary in the system of equation, the following 
transformation is used:

\begin{equation}
    x = \frac{S}{\bar{S}(t)}
\end{equation}

Next,

\begin{equation}
    v(x, t) := V(x\bar{S}(t), t) = V(S, t)
\end{equation}


By computing the partial derivatives of V with respect to S and t

\begin{equation}
    \frac{\partial{V}}{\partial{t}} =  \frac{\partial{v}}{\partial{t}} + \frac{\partial{v}}{\partial{x}} \frac{\partial{x}}{\partial{t}} 
    = \frac{\partial{v}}{\partial{t}} - x\frac{\bar{S}^\prime(t)}{\bar{S}(t)}\frac{\partial{v}}{\partial{x}} 
\end{equation}

\begin{equation}
    \frac{\partial{V}}{\partial{S}} = \frac{\partial{v}}{\partial{x}} 
    \frac{\partial{x}}{\partial{S}} = 
    \frac{1}{\bar{S}(t)} \frac{\partial{v}}{\partial{x}}
\end{equation}

\begin{equation}
    \frac{\partial^2{V}}{\partial{S^2}} =
    \frac{1}{\bar{S}(t)^2} \frac{\partial^2{v}}{\partial{x}^2}
\end{equation}

an expression for (3.1) with respect to $x$ is derived:

\begin{equation}
    \frac{\partial{v}}{\partial{t}} + \frac{1}{2}\sigma^{2} x^2 \frac{\partial^2{v}}{\partial{x}^2} + \bigg[(r - \delta) - \frac{\bar{S}^\prime(t)}{\bar{S}(t)}\bigg]x\frac{\partial{v}}{\partial{x}} - rv = 0 \quad \text{for $x > 1$ and $0 \le t < T$}
\end{equation}

Similarly, (3.2) is reformulated in term of x to:

\begin{equation}
    v(x, t) = K - x\bar{S}(t) \quad  \text{for $0 \le x \le 1$ and $0 \le t < T$}
\end{equation}

Next, the terminal condition (3.3) is re-written with respect of x:

\begin{equation}
    v(x, T) = \max(K - x\bar{S}(T), 0) = K \max(1 - x, 0) = 0 \quad \text{for $x \ge 1$}
\end{equation}

Finally, the left and right boundary conditions are given with respect to x:

\begin{equation}
    \frac{\partial{v}}{\partial{x}}(x, t) = -\bar{S}(t)
\end{equation}

\begin{equation}
    \lim_{x \rightarrow \infty} v(x, t) = 0
\end{equation}

In summary, a non linear system of PDEs is obtained:

\begin{align}
    & \frac{\partial{v}}{\partial{t}} + \frac{1}{2}\sigma^{2} x^2 \frac{\partial^2{v}}{\partial{x}^2} + \bigg[(r - \delta) - \frac{\bar{S}^\prime(t)}{\bar{S}(t)}\bigg]x\frac{\partial{v}}{\partial{x}} - rv = 0 & \text{for $x > 1$ and $0 \le t < T$} \\
    & v(x, t) = K - x\bar{S}(t) & \text{for $0 \le x \le 1$ and $0 \le t < T$} \\
    & v(x, T) = 0 & \text{for $x \ge 1$} \\
    & \frac{\partial{v}}{\partial{x}}(x, t) = -\bar{S}(t) & \\
    & \lim_{x \rightarrow \infty} v(x, t) = 0 & \\
    & \bar{S}(T) = K & 
\end{align}

\subsubsection{Theta method}

We discretize the system of equation containing (3.17) and (3.18) to solve it. 
Firstly, we define an uniform meshgrid within the region $[1, x_\text{max}]\times [0, T]$ and 
with resolution $\Delta x$ and $\Delta t$.

\begin{align*}
    M := \frac{x_{\text{max}} - 1}{\Delta x}
    \qquad
    N := \frac{T}{\Delta t}
\end{align*}

\begin{align*}
   & & x_i &:= 1 + i{\Delta x} &\text{for $i = 0,\dots,M$} & & \\ 
   & & t_n &:= n{\Delta t} &\text{for $n = 0,\dots,N$} & &
\end{align*}

Now we define the approximations

\begin{equation}
    v^{n}_{i} \approx v(x_{i}, t_{n}) \qquad \text{for $(x_{i}, t_{n}) \in \{x_k\}^{M}_{0} \times \{t_k\}^{N}_{0}$} 
\end{equation}
\begin{equation}
    \bar{S}^{n} \approx \bar{S}(t_{n}) \qquad \text{for $t_{n} \in \{t_k\}^{N}_{0}$} 
\end{equation}

By the boundary conditions, we can derive an expression for

\begin{align}
    v^{n}_{0} &= K - \bar{S}^{n} \qquad \text{for $n = 0, \dots, N - 1, N$} \\
    v^{n}_{M+1} &= 0 \qquad \text{for $n = 0, \dots, N - 1, N$}
\end{align}

Additionally by using the smothness condition, we get:

\begin{align}
    \frac{v^{n}_{1} - v^{n}_0}{\Delta x} = -\bar{S}^{n}
\end{align}

or 

\begin{align}
    v^{n}_{1}= K - (1 + {\Delta x})\bar{S}^{n}
\end{align}

Next, we equation (3.XX) discretize using centered finite difference. The discretization
method, we use is the theta method which a interpolation between an implicit and explicit scheme.

\begin{equation}
    \begin{split}
        v^{t+1}_{i} &- v^{t}_{i} + \theta \bigg\{ \frac{1}{2}\sigma^2 x^{2}_{i} \frac{\Delta t}{(\Delta x)^2} (v^{t}_{i-1} - 2 v^{t}_{i} + v^{t}_{i+1}) + \bigg[ (r - \delta) - \frac{1}{\bar{S}^t} \frac{\bar{S}^{t+1} - \bar{S}^{t}}{\Delta t} \bigg] \frac{\Delta t}{2\Delta x} (v_{i+1}^{t} - v_{i-1}^{t}) - r v^{t}_{i} \Delta t \bigg\}
        \\ & + (1-\theta) \bigg\{ \frac{1}{2}\sigma^2 x^{2}_{i} \frac{\Delta t}{(\Delta x)^2}(v^{t+1}_{i-1} - 2 v^{t+1}_{i} + v^{t+1}_{i+1}) 
        \\ &  + \bigg[ (r - \delta) - \frac{1}{\bar{S}^{t+1}} \frac{\bar{S}^{t+1} - \bar{S}^{t}}{\Delta t} \bigg]\frac{\Delta t}{2\Delta x}(v_{i+1}^{t+1} - v_{i-1}^{t+1}) - r v^{t+1}_{i} \Delta t \bigg\} = 0
    \end{split}
\end{equation}

To simplify the expression above, we introduce the following terms

\begin{equation}
    \lambda := \frac{\Delta t}{(\Delta x)^2}
\end{equation}

\begin{align}
    \alpha_i &:= 1 + \theta (\lambda \sigma^2 x_{i}^{2} + r{\Delta t}) \\
    \beta_i &:= - \frac{1}{2} \lambda \theta \bigg[ \sigma^{2} x_{i}^{2} - x_i \Delta x (r - \delta) \bigg]  - \frac{1}{2} \lambda \theta   x_i \Delta x \frac{\bar{S}^{n+1} - \bar{S}^{n}}{\Delta t \bar{S}^n}  \\
    \gamma_i &:= -\frac{1}{2} \lambda \theta \bigg[ \sigma^{2} x_{i}^{2} + x_i \Delta x (r - \delta) \bigg]  + \frac{1}{2} \lambda \theta  x_i \Delta x  \frac{\bar{S}^{n+1} - \bar{S}^{n}}{\Delta t \bar{S}^n}\\
    a_i &:= 1 - (1-\theta) (\lambda \sigma^2 x_{i}^{2} +  r{\Delta t}) \\
    b_i &:= \frac{1}{2} (1-\theta) \lambda \bigg[\sigma^{2} x_{i}^{2} - x_i \Delta x \bigg( (r - \delta) - \frac{1}{\Delta t} \bigg) \bigg] \\
    c_i &:= \frac{1}{2} (1-\theta) \lambda \bigg[ \sigma^{2} x_{i}^{2} +  x_i \Delta x \bigg( (r - \delta) - \frac{1}{\Delta t} \bigg) \bigg] \\
    d^{n+1}_i &:= (1-\theta) \frac{x_i}{2 \Delta x}  \frac{v^{n+1}_{i+1} - v^{n+1}_{i-1}}{\bar{S}^{n+1}}
\end{align}

Now, the expression above becomes

\begin{equation}
    \beta^{n}_{i} v^{n}_{i-1} + \alpha^{n}_{i} v^{n}_{i} + \gamma^{n}_{i} v^{n}_{i+1} = b_i v^{n+1}_{i-1} + a_i v^{n+1}_{i} + c_i v^{n+1}_{i+1} + d^{n+1}_{i}\bar{S}^{n}
\end{equation}

\begin{align}
    \gamma^{n}_{1} v^{n}_{2} = b_1 v^{n+1}_{0} + a_1 v^{n+1}_{1} + c_1 v^{n+1}_{2} + d^{n+1}_{1}\bar{S}^{n} - \beta^{n}_{1} (K - \bar{S}^n) - \alpha^{n}_{1} (K - (1+\Delta x)\bar{S}^n) 
\end{align}

\begin{equation}
    \alpha^{n}_{2} v^{n}_{2} + \gamma^{n}_{2} v^{n}_{3} = b_2 v^{n+1}_{1} + a_2 v^{n+1}_{2} + c_2 v^{n+1}_{3} + d^{n+1}_{2}\bar{S}^{n} - \beta^{n}_{2} (K - (1+\Delta x)\bar{S}^n) 
\end{equation}

\begin{equation}
    \beta^{n}_{M} v^{n}_{M-1} + \alpha^{n}_{M} v^{n}_{M} = b_i v^{n+1}_{i-1} + a_i v^{n+1}_{i} + c_i v^{n+1}_{i+1} + d^{n+1}_{i}\bar{S}^{n}
\end{equation}

\subsection{Log transformation}



\begin{equation}
    \dfrac{\partial{v}}{\partial{t}} + \dfrac{1}{2}\sigma^{2}\dfrac{\partial^{2}{v}}{\partial{x^2}} + \bigg( r - \delta - \dfrac{\sigma^2}{2} \bigg)\dfrac{\partial{v}}{\partial{x}} + \dfrac{\bar{S}'(t)}{\bar{S}(t)}\dfrac{\partial{v}}{\partial{x}} - rv = 0 \qquad \text{for $x > \log(K)$} 
\end{equation}


\begin{equation}
    v(\log(K), t) = K - \bar{S}(t) 
\end{equation}

\begin{equation}
    \dfrac{\partial{v}}{\partial{x}}(\log(K), t) = -\bar{S}(t) 
\end{equation}